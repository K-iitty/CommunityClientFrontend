<!-- pages/property/vehicle/vehicle-detail/vehicle-detail.wxml -->
<view class="page">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">
    <view class="loading-spinner"></view>
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{empty && !loading}}" class="empty-state">
    <view class="empty-icon">ğŸ“‹</view>
    <view class="empty-text">è½¦è¾†ä¸å­˜åœ¨</view>
    <button class="back-btn" bindtap="goBack">è¿”å›åˆ—è¡¨</button>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view wx:if="{{vehicle && !loading}}" class="content">
    <!-- åŸºæœ¬ä¿¡æ¯å¡ç‰‡ -->
    <view class="card">
      <view class="card-title">åŸºæœ¬ä¿¡æ¯</view>
      <view class="card-content">
        <!-- è½¦ç‰Œå· -->
        <view class="info-item">
          <view class="info-label">è½¦ç‰Œå·</view>
          <view class="info-value" wx:if="{{!isEditing}}">{{vehicle.plateNumber || '-'}}</view>
          <input wx:if="{{isEditing}}" class="form-input" type="text" value="{{editData.plateNumber}}" data-field="plateNumber" bindinput="onInputChange" placeholder="è¾“å…¥è½¦ç‰Œå·" />
        </view>
        
        <!-- è½¦è¾†ç±»å‹ -->
        <view class="info-item">
          <view class="info-label">è½¦è¾†ç±»å‹</view>
          <view class="info-value" wx:if="{{!isEditing}}">{{vehicle.vehicleType || '-'}}</view>
          <input wx:if="{{isEditing}}" class="form-input" type="text" value="{{editData.vehicleType}}" data-field="vehicleType" bindinput="onInputChange" placeholder="å¦‚ï¼šå°å‹è½¦ã€SUV" />
        </view>
        
        <!-- å“ç‰Œ -->
        <view class="info-item">
          <view class="info-label">å“ç‰Œ</view>
          <view class="info-value" wx:if="{{!isEditing}}">{{vehicle.brand || '-'}}</view>
          <input wx:if="{{isEditing}}" class="form-input" type="text" value="{{editData.brand}}" data-field="brand" bindinput="onInputChange" placeholder="è¾“å…¥å“ç‰Œ" />
        </view>
        
        <!-- å‹å· -->
        <view class="info-item">
          <view class="info-label">å‹å·</view>
          <view class="info-value" wx:if="{{!isEditing}}">{{vehicle.model || '-'}}</view>
          <input wx:if="{{isEditing}}" class="form-input" type="text" value="{{editData.model}}" data-field="model" bindinput="onInputChange" placeholder="è¾“å…¥å‹å·" />
        </view>
        
        <!-- é¢œè‰² -->
        <view class="info-item">
          <view class="info-label">é¢œè‰²</view>
          <view class="info-value" wx:if="{{!isEditing}}">{{vehicle.color || '-'}}</view>
          <input wx:if="{{isEditing}}" class="form-input" type="text" value="{{editData.color}}" data-field="color" bindinput="onInputChange" placeholder="è¾“å…¥é¢œè‰²" />
        </view>
      </view>
    </view>

    <!-- è¯ä»¶ä¿¡æ¯å¡ç‰‡ -->
    <view class="card">
      <view class="card-title">è¯ä»¶ä¿¡æ¯</view>
      <view class="card-content">
        <!-- è¡Œé©¶è¯å· -->
        <view class="info-item">
          <view class="info-label">è¡Œé©¶è¯å·</view>
          <view class="info-value" wx:if="{{!isEditing}}">{{vehicle.vehicleLicenseNo || '-'}}</view>
          <input wx:if="{{isEditing}}" class="form-input" type="text" value="{{editData.vehicleLicenseNo}}" data-field="vehicleLicenseNo" bindinput="onInputChange" placeholder="è¾“å…¥è¡Œé©¶è¯å·" />
        </view>
        
        <!-- å‘åŠ¨æœºå· -->
        <view class="info-item">
          <view class="info-label">å‘åŠ¨æœºå·</view>
          <view class="info-value" wx:if="{{!isEditing}}">{{vehicle.engineNo || '-'}}</view>
          <input wx:if="{{isEditing}}" class="form-input" type="text" value="{{editData.engineNo}}" data-field="engineNo" bindinput="onInputChange" placeholder="è¾“å…¥å‘åŠ¨æœºå·" />
        </view>
        
        <!-- æ³¨å†Œæ—¥æœŸ -->
        <view class="info-item" wx:if="{{vehicle.registerDate || isEditing}}">
          <view class="info-label">æ³¨å†Œæ—¥æœŸ</view>
          <view class="info-value" wx:if="{{!isEditing}}">{{vehicle.registerDate || '-'}}</view>
          <input wx:if="{{isEditing}}" class="form-input" type="text" value="{{editData.registerDate}}" data-field="registerDate" bindinput="onInputChange" placeholder="YYYY-MM-DD" />
        </view>
      </view>
    </view>

    <!-- åœè½¦ä½ä¿¡æ¯å¡ç‰‡ -->
    <view class="card" wx:if="{{vehicle.fixedSpaceId || isEditing}}">
      <view class="card-title">åœè½¦ä½ä¿¡æ¯</view>
      <view class="card-content">
        <view class="info-item">
          <view class="info-label">å›ºå®šåœè½¦ä½ID</view>
          <view class="info-value" wx:if="{{!isEditing}}">{{vehicle.fixedSpaceId || '-'}}</view>
          <input wx:if="{{isEditing}}" class="form-input" type="number" value="{{editData.fixedSpaceId}}" data-field="fixedSpaceId" bindinput="onInputChange" placeholder="è¾“å…¥åœè½¦ä½ID" />
        </view>
      </view>
    </view>

    <!-- ä¸šä¸»ä¿¡æ¯å¡ç‰‡ -->
    <view class="card" wx:if="{{vehicle.ownerId}}">
      <view class="card-title">ä¸šä¸»ä¿¡æ¯</view>
      <view class="card-content">
        <view class="info-item">
          <view class="info-label">ä¸šä¸»ID</view>
          <view class="info-value" wx:if="{{!isEditing}}">{{vehicle.ownerId}}</view>
          <input wx:if="{{isEditing}}" class="form-input" type="number" value="{{editData.ownerId}}" data-field="ownerId" bindinput="onInputChange" placeholder="ä¸šä¸»ID" />
        </view>
      </view>
    </view>

    <!-- çŠ¶æ€å¡ç‰‡ -->
    <view class="card">
      <view class="card-title">çŠ¶æ€ä¿¡æ¯</view>
      <view class="card-content">
        <view class="info-item">
          <view class="info-label">çŠ¶æ€</view>
          <view class="info-value status {{vehicle.status === 'æ­£å¸¸' ? 'normal' : 'abnormal'}}" wx:if="{{!isEditing}}">
            {{vehicle.status || 'æ­£å¸¸'}}
          </view>
          <picker wx:if="{{isEditing}}" class="form-input" mode="selector" range="{{statusOptions}}" bindchange="onStatusChange">
            <view class="picker-value">{{editData.status || 'æ­£å¸¸'}}</view>
          </picker>
        </view>
        
        <!-- å¤‡æ³¨ -->
        <view class="info-item">
          <view class="info-label">å¤‡æ³¨</view>
          <view class="info-value" wx:if="{{!isEditing}}">{{vehicle.remark || '-'}}</view>
          <input wx:if="{{isEditing}}" class="form-input" type="text" value="{{editData.remark}}" data-field="remark" bindinput="onInputChange" placeholder="è¾“å…¥å¤‡æ³¨" />
        </view>
      </view>
    </view>

    <!-- é©¾é©¶è¯å›¾ç‰‡å¡ç‰‡ -->
    <view class="card" wx:if="{{vehicle.driverLicenseImage || isEditing}}">
      <view class="card-title">é©¾é©¶è¯</view>
      <view class="card-content">
        <!-- æ˜¾ç¤ºæ¨¡å¼ -->
        <view wx:if="{{!isEditing && vehicle.driverLicenseImage}}" class="img-box">
          <image class="img" src="{{vehicle.driverLicenseImage}}" mode="aspectFill" bindtap="previewDriverLicense" />
        </view>
        
        <!-- ç¼–è¾‘æ¨¡å¼ -->
        <view wx:if="{{isEditing}}" class="edit-img-section">
          <!-- å·²æœ‰å›¾ç‰‡éƒ¨åˆ†ï¼ˆæ¥è‡ªæ•°æ®åº“æˆ–æ–°ä¸Šä¼ ï¼‰ -->
          <view wx:if="{{!driverLicenseImageToDelete && (vehicle.driverLicenseImage || editDriverLicenseImage)}}" class="img-box">
            <image class="img" src="{{editDriverLicenseImage || vehicle.driverLicenseImage}}" mode="aspectFill" />
            <view class="image-delete" bindtap="deleteDriverLicense">âœ•</view>
          </view>
          
          <!-- ä¸Šä¼ æŒ‰é’®ï¼ˆä»…åœ¨æ— å›¾ç‰‡æ—¶æ˜¾ç¤ºï¼‰ -->
          <view wx:if="{{driverLicenseImageToDelete || (!vehicle.driverLicenseImage && !editDriverLicenseImage)}}" class="image-upload" bindtap="chooseDriverLicenseImage">
            <view class="upload-icon">â•</view>
            <view class="upload-text">ä¸Šä¼ é©¾é©¶è¯</view>
          </view>
        </view>
      </view>
    </view>

    <!-- è½¦è¾†å›¾ç‰‡å¡ç‰‡ -->
    <view class="card" wx:if="{{vehicleImagesList.length > 0 || isEditing}}">
      <view class="card-title">è½¦è¾†ç…§ç‰‡ï¼ˆæœ€å¤š1å¼ ï¼‰</view>
      <view class="card-content">
        <!-- æ˜¾ç¤ºæ¨¡å¼ -->
        <view wx:if="{{!isEditing && vehicleImagesList.length > 0}}" class="img-box">
          <image class="img" src="{{vehicleImagesList[0]}}" mode="aspectFill" bindtap="previewVehicleImage" data-index="0" />
        </view>
        
        <!-- ç¼–è¾‘æ¨¡å¼ -->
        <view wx:if="{{isEditing}}" class="edit-img-section">
          <!-- å·²æœ‰å›¾ç‰‡éƒ¨åˆ†ï¼ˆæ¥è‡ªæ•°æ®åº“æˆ–æ–°ä¸Šä¼ ï¼‰ -->
          <view wx:if="{{!vehicleImageToDelete && (vehicleImagesList.length > 0 || editVehicleImage)}}" class="img-box">
            <image class="img" src="{{editVehicleImage || vehicleImagesList[0]}}" mode="aspectFill" />
            <view class="image-delete" bindtap="deleteVehicleImage">âœ•</view>
          </view>
          
          <!-- ä¸Šä¼ æŒ‰é’®ï¼ˆä»…åœ¨æ— å›¾ç‰‡æ—¶æ˜¾ç¤ºï¼‰ -->
          <view wx:if="{{vehicleImageToDelete || (vehicleImagesList.length === 0 && !editVehicleImage)}}" class="image-upload" bindtap="chooseVehicleImage">
            <view class="upload-icon">â•</view>
            <view class="upload-text">ä¸Šä¼ è½¦è¾†ç…§ç‰‡</view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ—¶é—´æˆ³ -->
    <view class="card">
      <view class="card-title">è®°å½•æ—¶é—´</view>
      <view class="card-content">
        <view class="info-item" wx:if="{{vehicle.createdAt}}">
          <view class="info-label">åˆ›å»ºæ—¶é—´</view>
          <view class="info-value">{{vehicle.createdAt}}</view>
        </view>
        <view class="info-item" wx:if="{{vehicle.updatedAt}}">
          <view class="info-label">æ›´æ–°æ—¶é—´</view>
          <view class="info-value">{{vehicle.updatedAt}}</view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="actions">
      <button class="action-btn edit-btn" wx:if="{{!isEditing}}" bindtap="startEdit">ç¼–è¾‘</button>
      <button class="action-btn save-btn" wx:if="{{isEditing}}" bindtap="submitEdit" disabled="{{submitting}}">{{submitting ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜'}}</button>
      <button class="action-btn cancel-btn" wx:if="{{isEditing}}" bindtap="cancelEdit" disabled="{{submitting}}">å–æ¶ˆ</button>
    </view>

    <!-- è¿”å›æŒ‰é’® -->
    <button class="back-btn" bindtap="goBack">è¿”å›åˆ—è¡¨</button>
  </view>
</view>
