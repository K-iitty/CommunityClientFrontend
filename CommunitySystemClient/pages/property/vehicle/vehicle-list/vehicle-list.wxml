<!-- pages/property/vehicle/vehicle-list/vehicle-list.wxml -->

<view class="page">
 <!-- æ¨¡å¼åˆ‡æ¢æ¡ -->
 <view class="mode-bar">
      <view class="mode-btn {{mode === 'vehicle' ? 'active' : ''}}" bindtap="switchMode" data-mode="vehicle">
        è½¦è¾†
      </view>
      <view class="mode-divider"></view>
      <view class="mode-btn {{mode === 'parking' ? 'active' : ''}}" bindtap="switchMode" data-mode="parking">
        åœè½¦ä½
      </view>
    </view>

  <!-- è½¦è¾†æ¨¡å¼ - æœç´¢æ  -->
  <view class="search-container" wx:if="{{mode === 'vehicle'}}">
    <view class="search-bar">
      <input 
        class="search-input" 
        type="text" 
        placeholder="æœç´¢è½¦ç‰Œå·"
        bindinput="onSearchInput"
        value="{{searchKeyword}}"
      />
      <button class="search-btn" bindtap="handleSearch">æœç´¢</button>
    </view>
  </view>

  <!-- åœè½¦ä½æ¨¡å¼ - ç­›é€‰æ  -->
  <view class="filter-container" wx:if="{{mode === 'parking'}}">
    <view class="filter-bar">
      <view class="filter-tag {{statusFilter === '' ? 'active' : ''}}" bindtap="setStatusFilter" data-status="">
        <view class="tag-text">å…¨éƒ¨</view>
      </view>
      <view class="filter-tag {{statusFilter === 'ç©ºé—²' ? 'active' : ''}}" bindtap="setStatusFilter" data-status="ç©ºé—²">
        <view class="tag-text">ç©ºé—²</view>
      </view>
      <view class="filter-tag {{statusFilter === 'å·²ç§Ÿ' ? 'active' : ''}}" bindtap="setStatusFilter" data-status="å·²ç§Ÿ">
        <view class="tag-text">å·²ç§Ÿ</view>
      </view>
      <view class="filter-tag {{statusFilter === 'å ç”¨' ? 'active' : ''}}" bindtap="setStatusFilter" data-status="å ç”¨">
        <view class="tag-text">å ç”¨</view>
      </view>
      <view class="filter-tag {{statusFilter === 'ç»´ä¿®' ? 'active' : ''}}" bindtap="setStatusFilter" data-status="ç»´ä¿®">
        <view class="tag-text">ç»´ä¿®</view>
      </view>
    </view>
  </view>

  <!-- ä¸»å†…å®¹åŒº -->
  <view class="content">

    <!-- è½¦è¾†æ¨¡å¼ -->
    <view wx:if="{{mode === 'vehicle'}}">
      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading" wx:if="{{loading && page === 1}}">
        <view class="loading-spinner"></view>
        <view class="loading-text">åŠ è½½ä¸­...</view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{empty && !loading}}">
        <view class="empty-icon">ğŸ“‹</view>
        <view class="empty-text">æš‚æ— è½¦è¾†æ•°æ®</view>
        <button class="add-btn-primary" bindtap="goToAdd">æ–°å¢è½¦è¾†</button>
      </view>

      <!-- è½¦è¾†åˆ—è¡¨ -->
      <view class="vehicle-list" wx:if="{{!loading && !empty}}">
        <view class="vehicle-card" wx:for="{{vehicles}}" wx:key="id">
          <!-- å¡ç‰‡å¤´éƒ¨ - è½¦ç‰Œå’Œç±»å‹ -->
          <view class="card-header">
            <view class="plate-badge">{{item.plateNumber || item.licensePlate}}</view>
            <view class="vehicle-type-badge">{{item.vehicleType}}</view>
          </view>

          <!-- å¡ç‰‡å†…å®¹ -->
          <view class="card-content">
            <!-- ç¬¬ä¸€è¡Œï¼šå“ç‰Œå‹å· -->
            <view class="info-row">
              <view class="info-group">
                <view class="label">å“ç‰Œå‹å·</view>
                <view class="alue">{{item.brand || '-'}} {{item.model || '-'}}</view>
              </view>
              <view class="info-group">
                <view class="label">è½¦è‰²</view>
                <view class="value">{{item.color || 'æœªå¡«å†™'}}</view>
              </view>
            </view>
          </view>

          <!-- æ“ä½œæŒ‰é’® -->
          <view class="card-actions">
            <button class="action-btn view-btn" bindtap="viewDetails" data-id="{{item.id}}">è¯¦æƒ…</button>
            <button class="action-btn delete-btn" bindtap="deleteVehicle" data-id="{{item.id}}">åˆ é™¤</button>
          </view>
        </view>
      </view>

      <!-- åŠ è½½å®Œæˆæç¤º -->
      <view class="load-complete" wx:if="{{!hasMore && vehicles.length > 0 && !loading}}">
        å·²åŠ è½½å…¨éƒ¨ (å…±{{total}}æ¡)
      </view>
    </view>

    <!-- åœè½¦ä½æ¨¡å¼ -->
    <view wx:if="{{mode === 'parking'}}">

      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading" wx:if="{{loadingParking && pageParking === 1}}">
        <view class="loading-spinner"></view>
        <view class="loading-text">åŠ è½½ä¸­...</view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{emptyParking && !loadingParking}}">
        <view class="empty-icon">ğŸ…¿ï¸</view>
        <view class="empty-text">æš‚æ— è½¦ä½æ•°æ®</view>
      </view>

      <!-- è½¦ä½åˆ—è¡¨ -->
      <view class="parking-list" wx:if="{{!loadingParking && !emptyParking}}">
        <view class="parking-card" wx:for="{{parkingSpaces}}" wx:key="id">
          <!-- å¡ç‰‡å¤´éƒ¨ - è½¦ä½å·å’ŒçŠ¶æ€ -->
          <view class="card-header">
            <view class="space-info">
              <view class="space-number">{{item.spaceNumber}}</view>
              <view class="space-lot-info">åœè½¦åœº #{{item.parkingLotId}}</view>
            </view>
            <view class="space-status-badge {{item.status === 'ç©ºé—²' ? 'status-vacant' : item.status === 'å·²ç§Ÿ' ? 'status-rented' : item.status === 'å ç”¨' ? 'status-occupied' : item.status === 'ç»´ä¿®' ? 'status-maintenance' : 'status-vacant'}}">{{item.status || 'ç©ºé—²'}}</view>
          </view>

          <!-- å¡ç‰‡å†…å®¹ -->
          <view class="card-content">
            <!-- ç¬¬ä¸€è¡Œï¼šå®Œæ•´å·å’Œç±»å‹ -->
            <view class="info-row">
              <view class="info-group">
                <view class="label">å®Œæ•´å·</view>
                <view class="value">{{item.fullSpaceNo || item.spaceNumber}}</view>
              </view>
              <view class="info-group">
                <view class="label">ç±»å‹</view>
                <view class="value">{{item.spaceType || 'å›ºå®š'}}</view>
              </view>
            </view>

            <!-- ç¬¬äºŒè¡Œï¼šé¢ç§¯å’Œæœˆç§Ÿè´¹ -->
            <view class="info-row">
              <view class="info-group">
                <view class="label">é¢ç§¯</view>
                <view class="value">{{item.spaceArea || '-'}} ã¡</view>
              </view>
              <view class="info-group">
                <view class="label">æœˆç§Ÿè´¹</view>
                <view class="value price">Â¥{{item.monthlyFee || '0'}}</view>
              </view>
            </view>

            <!-- ç¬¬ä¸‰è¡Œï¼šå¤‡æ³¨ -->
            <view class="info-row" wx:if="{{item.remark}}">
              <view class="info-group full-width">
                <view class="label">å¤‡æ³¨</view>
                <view class="value description">{{item.remark}}</view>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- åŠ è½½å®Œæˆæç¤º -->
      <view class="load-complete" wx:if="{{!hasMoreParking && parkingSpaces.length > 0 && !loadingParking}}">
        å·²åŠ è½½å…¨éƒ¨ (å…±{{totalParking}}æ¡)
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æµ®åŠ¨æŒ‰é’® -->
  <view class="fab-button-container" wx:if="{{mode === 'vehicle'}}">
    <button class="fab-button" bindtap="goToAdd">
      æ–°å¢è½¦è¾†
    </button>
  </view>
</view>