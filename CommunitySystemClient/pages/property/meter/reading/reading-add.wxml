<!--pages/property/meter/reading/reading-add.wxml-->
<view class="page">
  <!-- 页面头部 -->
  <!-- <view class="header">
    <view class="header-top">
      <view class="back-btn" bindtap="goBack">←</view>
      <view class="header-title">新增抄表记录</view>
      <view class="header-spacer"></view>
    </view>
  </view> -->

  <!-- 仪表信息 -->
  <view class="section">
    <view class="section-title">仪表信息</view>
    <view class="info-box">
      <!-- <view class="info-row">
        <view class="info-label">分类:</view>
        <view class="info-value">{{categoryName}}</view>
      </view>
      <view class="info-row">
        <view class="info-label">仪表种类:</view>
        <view class="info-value">{{meterType}}</view>
      </view> -->
      <view class="info-row">
        <view class="info-label">仪表名称:</view>
        <view class="info-value">{{meterName}}</view>
      </view>
      <view class="info-row">
        <view class="info-label">仪表编码:</view>
        <view class="info-value">{{meterCode}}</view>
      </view>
    </view>
  </view>

  <!-- 读数信息 -->
  <view class="section">
    <view class="section-title">读数信息 *</view>
    
    <!-- 上次读数 -->
    <view class="form-group">
      <view class="form-item">
        <label class="form-label">上次读数 *</label>
        <view class="form-input-wrapper">
          <input
            type="number"
            class="form-input"
            placeholder="请输入上次读数"
            value="{{previousReading}}"
            bindinput="onPreviousReadingChange"
            step="0.01"
          />
        </view>
      </view>
    </view>

    <!-- 本次读数 -->
    <view class="form-group">
      <view class="form-item">
        <label class="form-label">本次读数 *</label>
        <view class="form-input-wrapper">
          <input
            type="number"
            class="form-input"
            placeholder="请输入本次读数"
            value="{{currentReading}}"
            bindinput="onCurrentReadingChange"
            step="0.01"
          />
        </view>
      </view>
    </view>

    <!-- 用量（自动计算） -->
    <view class="form-group">
      <view class="form-item">
        <label class="form-label">用量（自动计算）</label>
        <view class="form-input-wrapper">
          <view class="form-input form-readonly">{{usageAmount || '0.00'}}</view>
        </view>
      </view>
    </view>

    <!-- 计量单位 -->
    <view class="form-group">
      <view class="form-item">
        <label class="form-label">计量单位</label>
        <view class="form-input-wrapper">
          <input
            type="text"
            class="form-input"
            placeholder="如：度、吨、立方米等"
            value="{{unit}}"
            bindinput="onUnitChange"
            maxlength="20"
          />
        </view>
      </view>
    </view>
  </view>

  <!-- 抄表信息 -->
  <view class="section">
    <view class="section-title">抄表信息</view>
    
    <!-- 抄表日期 -->
    <view class="form-group">
      <view class="form-item">
        <label class="form-label">抄表日期 *</label>
        <view class="form-input-wrapper">
          <picker
            mode="date"
            value="{{readingDate}}"
            bindchange="onReadingDateChange"
          >
            <view class="form-input picker-input">{{readingDate}}</view>
          </picker>
        </view>
      </view>
    </view>

    <!-- 抄表时间 -->
    <view class="form-group">
      <view class="form-item">
        <label class="form-label">抄表时间</label>
        <view class="form-input-wrapper">
          <picker
            mode="time"
            value="{{readingTime}}"
            bindchange="onReadingTimeChange"
          >
            <view class="form-input picker-input">{{readingTime}}</view>
          </picker>
        </view>
      </view>
    </view>

    <!-- 抄表类型 -->
    <view class="form-group">
      <view class="form-item">
        <label class="form-label">抄表类型</label>
        <view class="form-input-wrapper">
          <picker
            range="{{readingTypes}}"
            value="{{readingType === '手动' ? 0 : 1}}"
            bindchange="onReadingTypeChange"
          >
            <view class="form-input picker-input">{{readingType}}</view>
          </picker>
        </view>
      </view>
    </view>

    <!-- 抄表状态 -->
    <view class="form-group">
      <view class="form-item">
        <label class="form-label">抄表状态</label>
        <view class="form-input-wrapper">
          <picker
            range="{{readingStatuses}}"
            value="{{readingStatus === '正常' ? 0 : 1}}"
            bindchange="onReadingStatusChange"
          >
            <view class="form-input picker-input">{{readingStatus}}</view>
          </picker>
        </view>
      </view>
    </view>

    <!-- 异常原因 -->
    <view class="form-group" wx:if="{{readingStatus === '异常'}}">
      <view class="form-item">
        <label class="form-label">异常原因 *</label>
        <view class="form-input-wrapper">
          <textarea
            class="form-textarea"
            placeholder="请描述异常原因"
            value="{{abnormalReason}}"
            bindinput="onAbnormalReasonChange"
            maxlength="200"
          ></textarea>
        </view>
      </view>
    </view>
  </view>

  <!-- 备注 -->
  <view class="section">
    <view class="section-title">备注信息</view>
    <view class="form-group">
      <view class="form-item">
        <label class="form-label">备注</label>
        <view class="form-input-wrapper">
          <textarea
            class="form-textarea"
            placeholder="请输入备注信息（可选）"
            value="{{remark}}"
            bindinput="onRemarkChange"
            maxlength="200"
          ></textarea>
        </view>
      </view>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="action-buttons">
    <view class="debug-info" wx:if="{{false}}">
      <text>meterId: {{meterId}}</text>
      <text>currentReading: {{currentReading}}</text>
      <text>readingDate: {{readingDate}}</text>
      <text>readingTime: {{readingTime}}</text>
    </view>
    <view
      class="btn btn-primary"
      bindtap="submitForm"
      style="{{submitting ? 'opacity: 0.6; cursor: not-allowed;' : ''}}"
    >
      {{submitting ? '提交中...' : '确认提交'}}
    </view>
    <view class="btn btn-secondary" bindtap="goBack">
      返回
    </view>
  </view>

  <!-- 底部间距 -->
  <view class="page-bottom"></view>
</view>
