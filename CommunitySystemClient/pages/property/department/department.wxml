<!-- pages/property/department/department.wxml -->
<!-- éƒ¨é—¨ç®¡ç† - éƒ¨é—¨ä¿¡æ¯é¡µé¢ -->

<view class="page">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">
    <view class="loading-spinner"></view>
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{empty && !loading}}" class="empty-state">
    <view class="empty-icon">ğŸ¢</view>
    <view class="empty-text">éƒ¨é—¨ä¿¡æ¯åŠ è½½å¤±è´¥</view>
    <button class="retry-btn" bindtap="loadDepartmentData">é‡è¯•</button>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view wx:if="{{department && !loading}}" class="content">
    <!-- éƒ¨é—¨å¤´éƒ¨å¡ç‰‡ -->
    <view class="department-header">
      <view class="header-left">
        <view class="header-icon">ğŸ¢</view>
        <view class="header-info">
          <view class="dept-name">{{department.departmentName}}</view>
          <view class="dept-code">{{department.departmentCode || 'N/A'}}  |  {{department.departmentLevel || 'ä¸€çº§'}}</view>
        </view>
      </view>
      <view class="member-count">{{members.length}}äºº</view>
    </view>

    <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
    <view class="tabs-container">
      <view class="tabs">
        <block wx:for="{{tabs}}" wx:key="id">
          <view 
            class="tab-item {{activeTab === item.id ? 'active' : ''}}"
            data-id="{{item.id}}"
            bindtap="switchTab"
          >
            {{item.label}}
          </view>
        </block>
      </view>
    </view>

    <!-- æ ‡ç­¾é¡µå†…å®¹ -->
    <!-- éƒ¨é—¨ä¿¡æ¯ -->
    <view wx:if="{{activeTab === 'info'}}" class="tab-content">
      <view class="info-card">
        <view class="section-title">éƒ¨é—¨ä¿¡æ¯</view>
        
        <view class="info-grid">
          <view class="info-item">
            <view class="label">éƒ¨é—¨åç§°</view>
            <view class="value">{{department.departmentName}}</view>
          </view>

          <view class="info-item">
            <view class="label">éƒ¨é—¨ä»£ç </view>
            <view class="value">{{department.departmentCode || '-'}}</view>
          </view>

          <view class="info-item">
            <view class="label">éƒ¨é—¨ç­‰çº§</view>
            <view class="value">{{department.departmentLevel || 'ä¸€çº§'}}</view>
          </view>

          <view class="info-item">
            <view class="label">æˆå‘˜æ•°é‡</view>
            <view class="value">{{members.length || 0}}äºº</view>
          </view>

          <view class="info-item">
            <view class="label">éƒ¨é—¨æè¿°</view>
            <view class="value">{{department.description || '-'}}</view>
          </view>

          <view class="info-item">
            <view class="label">çŠ¶æ€</view>
            <view class="value" style="color: {{department.status === 'å¯ç”¨' ? '#10b981' : '#ef4444'}}">
              {{department.status || 'å¯ç”¨'}}
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å›¢é˜Ÿæˆå‘˜ -->
    <view wx:if="{{activeTab === 'members'}}" class="tab-content">
      <view class="members-section">
        <view class="section-title">å›¢é˜Ÿæˆå‘˜ ({{members.length}}äºº)</view>

        <view wx:if="{{members.length === 0}}" class="empty-tips">
          æš‚æ— å›¢é˜Ÿæˆå‘˜
        </view>

        <block wx:for="{{members}}" wx:key="id">
          <view class="member-card">
            <view class="member-header">
              <view class="member-avatar">ğŸ‘¤</view>
              <view class="member-title">
                <view class="member-name">{{item.name}}</view>
                <view class="member-workno">{{item.workNo || '-'}}</view>
              </view>
              <view class="member-status" style="color: {{item.workStatus === 'åœ¨èŒ' ? '#10b981' : '#ef4444'}}">
                {{item.workStatus || 'åœ¨èŒ'}}
              </view>
            </view>
            
            <view class="member-details">
              <view class="detail-item">
                <view class="detail-label">èŒä½</view>
                <view class="detail-value">{{item.position || '-'}}</view>
              </view>
              <view class="detail-item">
                <view class="detail-label">ç”µè¯</view>
                <view class="detail-value">{{item.phone || '-'}}</view>
              </view>
              <view class="detail-item">
                <view class="detail-label">æœ€åç™»å½•</view>
                <view class="detail-value">{{item.lastLoginTime || 'æœªç™»å½•'}}</view>
              </view>
            </view>
          </view>
        </block>
      </view>
    </view>

  </view>
</view>