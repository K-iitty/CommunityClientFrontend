<!--pages/property/feedback/list/list.wxml-->
<view class="page">
  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <input 
      class="search-input" 
      placeholder="è¾“å…¥åé¦ˆæ ‡é¢˜æœç´¢"
      bindinput="onSearch"
      value="{{searchKeyword}}"
    />
  </view>

  <!-- çŠ¶æ€è¿‡æ»¤æ ‡ç­¾ -->
  <view class="filter-tags">
    <view 
      class="filter-tag {{statusFilter === '' ? 'active' : ''}}"
      bindtap="onStatusFilter"
      data-status=""
    >
      å…¨éƒ¨
    </view>
    <view 
      class="filter-tag {{statusFilter === 'å¾…å¤„ç†' ? 'active' : ''}}"
      bindtap="onStatusFilter"
      data-status="å¾…å¤„ç†"
    >
      å¾…å¤„ç†
    </view>
    <view 
      class="filter-tag {{statusFilter === 'å¤„ç†ä¸­' ? 'active' : ''}}"
      bindtap="onStatusFilter"
      data-status="å¤„ç†ä¸­"
    >
      å¤„ç†ä¸­
    </view>
    <view 
      class="filter-tag {{statusFilter === 'å·²å®Œæˆ' ? 'active' : ''}}"
      bindtap="onStatusFilter"
      data-status="å·²å®Œæˆ"
    >
      å·²å®Œæˆ
    </view>
  </view>

  <!-- åé¦ˆåˆ—è¡¨ -->
  <view class="container">
    <block wx:if="{{filteredIssues.length > 0}}">
      <view 
        class="issue-card"
        wx:for="{{filteredIssues}}"
        wx:key="id"
        bindtap="onViewDetail"
        data-id="{{item.id}}"
      >
        <!-- æ ‡é¢˜å’ŒçŠ¶æ€ -->
        <view class="card-header">
          <view class="issue-title">{{item.issueTitle}}</view>
          <view class="status-badge {{item.statusClass}}">{{item.issueStatus}}</view>
        </view>

        <!-- ä¸šä¸»å’Œæˆ¿é—´ä¿¡æ¯ -->
        <view class="card-row">
          <view class="info-item">
            <text class="label">ä¸šä¸»:</text>
            <text class="value">{{item.contactName || item.ownerName || '-'}}</text>
          </view>
          <view class="info-item">
            <text class="label">æˆ¿é—´:</text>
            <text class="value">{{(item.house && item.house.roomNo) || '-'}}</text>
          </view>
        </view>

        <!-- é—®é¢˜ç±»å‹å’Œç´§æ€¥åº¦ -->
        <view class="card-row">
          <view class="info-item">
            <text class="label">ç±»å‹:</text>
            <text class="value">{{item.issueType || '-'}}</text>
          </view>
          <view class="info-item">
            <text class="label">çº§åˆ«:</text>
            <text class="value urgency-text urgency-text-1">{{item.urgencyLevel || 'ä¸­'}}</text>
          </view>
        </view>

        <!-- å¤„ç†å‘˜å’Œç”µè¯ -->
        <view class="card-row">
          <view class="info-item">
            <text class="label">å¤„ç†å‘˜:</text>
            <text class="value">{{(item.processor && item.processor.name) || '-'}}</text>
          </view>
          <view class="info-item">
            <text class="label">ç”µè¯:</text>
            <text class="value">{{item.contactPhone || '-'}}</text>
          </view>
        </view>

        <!-- æ—¶é—´ä¿¡æ¯ -->
        <view class="card-footer">
          <view class="time-info">
            <text class="time-label">æŠ¥å‘Š:</text>
            <text class="time-value">{{item.timeAgo}}</text>
          </view>
          <view class="time-info">
            <text class="time-label">æœ€åæ›´æ–°:</text>
            <text class="time-value">{{item.updatedAt || item.reportedTime || '-'}}</text>
          </view>
        </view>
      </view>
    </block>

    <!-- ç©ºçŠ¶æ€ -->
    <block wx:if="{{filteredIssues.length === 0 && !loading}}">
      <view class="empty-state">
        <view class="empty-icon">ğŸ“­</view>
        <view class="empty-text">æš‚æ— åé¦ˆè®°å½•</view>
      </view>
    </block>

    <!-- åŠ è½½çŠ¶æ€ -->
    <block wx:if="{{loading}}">
      <view class="loading">
        <text>åŠ è½½ä¸­...</text>
      </view>
    </block>

    <!-- åŠ è½½å®Œæˆæç¤º -->
    <view wx:if="{{!hasMore && issues.length > 0}}" class="load-complete">
      å·²åŠ è½½å…¨éƒ¨åé¦ˆ
    </view>
  </view>
</view>