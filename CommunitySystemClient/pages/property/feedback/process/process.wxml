<!--pages/property/feedback/process/process.wxml-->
<view class="page">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="header">
    <view class="header-content">
      <text class="header-title">å¤„ç†åé¦ˆ</text>
      <text class="issue-id">å·¥å• #{{id}}</text>
    </view>
    <view class="status-badge {{issue.issueStatus}}">{{issue.issueStatus}}</view>
  </view>

  <!-- é—®é¢˜æ‘˜è¦ -->
  <view class="section">
    <view class="section-title">é—®é¢˜æ‘˜è¦</view>
    <view class="summary-card">
      <view class="summary-item">
        <text class="summary-label">æ ‡é¢˜</text>
        <text class="summary-value">{{issue.issueTitle}}</text>
      </view>
      <view class="summary-item">
        <text class="summary-label">ä¸šä¸»</text>
        <text class="summary-value">{{issue.owner ? issue.owner.name : '-'}}</text>
      </view>
      <view class="summary-item">
        <text class="summary-label">æˆ¿å·</text>
        <text class="summary-value">{{issue.house ? issue.house.fullRoomNo : '-'}}</text>
      </view>
      <view class="summary-item">
        <text class="summary-label">ä¸ŠæŠ¥æ—¶é—´</text>
        <text class="summary-value">{{issue.reportedTime}}</text>
      </view>
    </view>
  </view>

  <!-- å¤„ç†æ–¹æ¡ˆè¡¨å• -->
  <view class="section">
    <view class="section-title">å¤„ç†æ–¹æ¡ˆ</view>
    <view class="form-card">
      <view class="form-section">
        <view class="form-label">
          <text>å¤„ç†æ–¹æ¡ˆ</text>
          <text style="color: #f44336;">*</text>
        </view>
        <textarea 
          class="form-input textarea"
          placeholder="è¯·è¯¦ç»†è¯´æ˜å¤„ç†æ–¹æ¡ˆ..."
          placeholder-style="color: #bbb"
          value="{{processPlan}}"
          bindinput="onPlanDescriptionInput"
          maxlength="500"
        />
        <view class="form-hint">{{processPlan.length}}/500</view>
      </view>
    </view>
  </view>

  <!-- å¤„ç†ç»“æœè¡¨å• -->
  <view class="section">
    <view class="section-title">å¤„ç†ç»“æœ</view>
    <view class="form-card">
      <view class="form-section">
        <view class="form-label">
          <text>å¤„ç†ç»“æœ</text>
          <text style="color: #f44336;">*</text>
        </view>
        <textarea 
          class="form-input textarea"
          placeholder="è¯·è¯´æ˜å¤„ç†å®Œæˆæƒ…å†µå’Œæ•ˆæœ..."
          placeholder-style="color: #bbb"
          value="{{resultDescription}}"
          bindinput="onResultDescriptionInput"
          maxlength="500"
        />
        <view class="form-hint">{{resultDescription.length}}/500</view>
      </view>
    </view>
  </view>

  <!-- å¤„ç†è¿‡ç¨‹å›¾ç‰‡ -->
  <view class="section">
    <view class="section-title">å¤„ç†è¿‡ç¨‹å›¾ç‰‡</view>
    <view class="upload-section">
      <view class="upload-title">
        <text>ä¸Šä¼ å›¾ç‰‡</text>
        <text style="color: #f44336;">*</text>
        <text style="color: #999; font-weight: 400; margin-left: 8rpx;">ï¼ˆæœ€å¤š{{maxImages}}å¼ ï¼‰</text>
      </view>

      <!-- å·²ä¸Šä¼ å›¾ç‰‡ -->
      <view class="image-grid" wx:if="{{uploadedImages && uploadedImages.length > 0}}">
        <block wx:for="{{uploadedImages}}" wx:key="index">
          <view class="image-item" bindtap="previewImage" data-index="{{index}}" data-urls="{{uploadedImages}}">
            <image src="{{item}}" mode="aspectFill" />
            <view class="delete-btn" bindtap="deleteImage" data-index="{{index}}">Ã—</view>
          </view>
        </block>
      </view>

      <!-- ä¸Šä¼ æŒ‰é’® -->
      <view 
        class="upload-button {{uploadedImages.length >= maxImages ? 'disabled' : ''}}"
        bindtap="chooseImage"
        style="{{uploadedImages.length >= maxImages ? 'opacity: 0.5; cursor: not-allowed;' : ''}}"
      >
        <view class="upload-icon">ğŸ“¸</view>
        <view class="upload-text">+ æ·»åŠ å›¾ç‰‡</view>
        <view style="font-size: 11px; color: #999; margin-top: 6rpx;">{{uploadedImages.length}}/{{maxImages}}</view>
      </view>

      <view class="upload-tip">
        æ”¯æŒ JPGã€PNG æ ¼å¼ï¼Œå•å¼ ä¸è¶…è¿‡ 5MB
      </view>
    </view>
  </view>

  <!-- æäº¤åŒºåŸŸ -->
  <view class="action-buttons">
    <button 
      class="btn btn-secondary"
      bindtap="onBack"
      disabled="{{submitting}}"
    >
      è¿”å›
    </button>
    <button 
      class="btn btn-primary" 
      bindtap="onSubmit"
      disabled="{{submitting}}"
    >
      {{submitting ? 'æäº¤ä¸­...' : 'æäº¤å¤„ç†ç»“æœ'}}
    </button>
  </view>
</view>