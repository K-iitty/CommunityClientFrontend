<!--pages/owner/ai-chat/ai-chat.wxml-->
<view class="chat-container">
  <!-- é¡¶éƒ¨æ“ä½œæ  -->
  <view class="chat-header">
    <text class="header-title">æ™ºèƒ½å®¢æœ</text>
    <button class="clear-btn" bindtap="clearMessages" plain size="mini">æ¸…ç©º</button>
  </view>

  <!-- æ¶ˆæ¯åˆ—è¡¨ -->
  <scroll-view 
    class="messages-area"
    scroll-y="true"
    scroll-top="{{scrollTop}}"
    enable-back-to-top="true"
    lower-threshold="50"
  >
    <view class="messages-list">
      <!-- å•æ¡æ¶ˆæ¯ -->
      <view 
        wx:for="{{messages}}" 
        wx:key="id"
        class="message-wrapper {{item.type === 'user' ? 'user-wrapper' : 'assistant-wrapper'}}"
      >
        <!-- åŠ©æ‰‹æ¶ˆæ¯ -->
        <view wx:if="{{item.type === 'assistant'}}" class="message-row assistant-row">
          <view class="avatar assistant-avatar">
            <image src="/img/img-ai/rengongkefu.png" class="avatar-image"></image>
          </view>
          <view class="message-content-wrapper">
            <view class="message-bubble assistant-bubble">
              <text class="message-text">{{item.content}}</text>
              <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
              <view wx:if="{{item.loading}}" class="typing-indicator">
                <view class="dot"></view>
                <view class="dot"></view>
                <view class="dot"></view>
              </view>
            </view>
            <view class="message-actions">
              <button 
                class="action-btn" 
                bindtap="copyMessage" 
                data-content="{{item.content}}"
              >
                å¤åˆ¶
              </button>
              <text class="message-time">{{item.timestamp}}</text>
            </view>
          </view>
        </view>

        <!-- ç”¨æˆ·æ¶ˆæ¯ -->
        <view wx:if="{{item.type === 'user'}}" class="message-row user-row">
          <view class="message-content-wrapper user-message-wrapper">
            <view class="message-bubble user-bubble">
              <text class="message-text">{{item.content}}</text>
            </view>
            <text class="message-time">{{item.timestamp}}</text>
          </view>
          <view class="avatar user-avatar">
            <image src="/img/img-ai/yonghu.png" class="avatar-image"></image>
          </view>
        </view>
      </view>

      <!-- åº•éƒ¨é—´è· -->
      <view class="message-bottom-space"></view>
    </view>
  </scroll-view>

  <!-- è¾“å…¥åŒºåŸŸ -->
  <view class="input-area">
    <view class="input-wrapper">
      <input 
        class="input-field"
        type="text"
        placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜..."
        placeholder-style="color: #BFBFBF"
        value="{{inputValue}}"
        bindinput="onInput"
        bindconfirm="sendMessage"
        confirm-type="send"
        adjust-position="true"
        hold-keyboard="false"
      />
      <button 
        class="send-btn-1 {{sending ? 'disabled' : ''}}"
        bindtap="sendMessage"
        disabled="{{sending}}"
      >
        {{sending ? '...' : 'å‘é€'}}
      </button>
    </view>
    <!-- <text class="tips">ğŸ’¡ æç¤ºï¼šæ‚¨å¯ä»¥æé—®å…³äºç¤¾åŒºã€ç‰©ä¸šã€ç”Ÿæ´»ç­‰ä»»ä½•é—®é¢˜</text> -->
  </view>
</view>
